<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Warehouse Query - Task 3</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 2rem;
      background: #f8f8f8;
      color: #333;
    }
    label, select, button {
      display: block;
      margin-top: 1rem;
      font-size: 1rem;
    }
    table {
      margin-top: 1.5rem;
      border-collapse: collapse;
      width: 100%;
      font-size: 0.95rem;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    pre {
      background: #eee;
      padding: 1rem;
      border-radius: 6px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>üì¶ Task 3 - Inventory Query & Signature Check</h2>

  <label for="itemId">Pick an item to check:</label>
  <select id="itemId">
    <option value="001">Item 001</option>
    <option value="002">Item 002</option>
    <option value="003">Item 003</option>
    <option value="004">Item 004</option>
  </select>

  <button onclick="queryItem()">Submit</button>

  <div id="output" style="margin-top:2rem;"></div>

  <script>
    async function queryItem() {
      const itemId = document.getElementById('itemId').value;
      const output = document.getElementById('output');
      output.innerHTML = 'Just a moment...';

      try {
        const res = await fetch('http://localhost:5000/query_item', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ item_id: itemId })
        });

        const data = await res.json();

        if (data.error) {
          output.innerHTML = `<p style="color:red">${data.error}</p>`;
          return;
        }

        const tableRows = data.warehouses.map(w => `
          <tr>
            <td>${w.warehouse}</td>
            <td>${w.ID}</td>
            <td>${w.r}</td>
            <td>${w.g}</td>
            <td>${w.t_i}</td>
            <td>${w.s_i}</td>
          </tr>`).join('');

        output.innerHTML = `
          <h3>üßæ Item Info</h3>
          <p><strong>ID:</strong> ${data.itemId}</p>
          <p><strong>Quantity:</strong> ${data.item.qty}</p>
          <p><strong>Price:</strong> $${data.item.price}</p>
          <p><strong>Location:</strong> ${data.item.location}</p>

          <h3>üè¨ Warehouse Signature Breakdown</h3>
          <table>
            <tr>
              <th>Warehouse</th>
              <th>ID</th>
              <th>r</th>
              <th>g·µ¢</th>
              <th>t·µ¢</th>
              <th>s·µ¢</th>
            </tr>
            ${tableRows}
          </table>

          <h3>üß† Signature & RSA Breakdown</h3>
          <pre>
Step a: Encrypted by PKG (RSA public key)
  - Decimal: ${data.encrypted_quantity}
  - Hex: 0x${BigInt(data.encrypted_quantity).toString(16)}

Step b: Sent to user with multi-signature details
  - Signature (s):
      - Decimal: ${data.signature}
      - Hex: 0x${BigInt(data.signature).toString(16)}
  - Aggregated t:
      - Decimal: ${data.t}
      - Hex: 0x${BigInt(data.t).toString(16)}
  - Hash h(t, m):
      - Decimal: ${data.hash}
      - Hex: 0x${BigInt(data.hash).toString(16)}

Step c: Decrypted by Procurement Officer
  - Decimal: ${data.decrypted_quantity}
  - Hex: 0x${BigInt(data.decrypted_quantity).toString(16)}

Step d: Signature Verification
  - LHS = s^e mod n = ${data.lhs}
      ‚Üí Hex: 0x${BigInt(data.lhs).toString(16)}
  - RHS = ID‚ÇÅ‚ãÖID‚ÇÇ‚ãÖ...‚ãÖt^h mod n = ${data.rhs}
      ‚Üí Hex: 0x${BigInt(data.rhs).toString(16)}

‚úÖ Signature check result: ${data.valid ? "VALID ‚úÖ" : "INVALID ‚ùå"}
          </pre>
        `;
      } catch (err) {
        output.innerHTML = `<p style="color:red">Error while querying: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>